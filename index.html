<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Workspace Pro</title>
    
    <meta http-equiv="Content-Security-Policy" content="
    default-src 'self' https://*.firebaseio.com https://*.firebaseapp.com https://www.youtube.com;
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://apis.google.com https://*.firebasejs.com https://*.firebaseapp.com https://*.firebasedatabase.app https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com;
    font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
    img-src 'self' data: https://www.gstatic.com https://lh3.googleusercontent.com https://i.ytimg.com;
    connect-src 'self' https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebasedatabase.app https://www.gstatic.com https://cdn.jsdelivr.net;
    frame-src https://*.firebaseapp.com https://accounts.google.com https://*.firebasedatabase.app https://www.youtube.com;
    ">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/schedule.css">
    <link rel="stylesheet" href="css/tasks.css">
    <link rel="stylesheet" href="css/pomodoro.css">
    <link rel="stylesheet" href="css/finance.css">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöÄ</text></svg>">
</head>
<body>

    <div id="loginOverlay" class="login-wrapper">
        <div class="background-shapes"></div>
        <div class="login-card fade-in-up">
            <div id="loginView">
                <div class="login-header">
                    <div class="icon-pulse">üëã</div>
                    <h1>Selamat Datang</h1>
                    <p>Masuk untuk melanjutkan</p>
                </div>
                <div class="login-form">
                    <div class="input-group" style="margin-bottom: 10px;">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="loginEmail" placeholder="Email" aria-label="Alamat Email">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="loginPass" placeholder="Password" aria-label="Kata Sandi">
                    </div>
                    <button onclick="handleLogin()" class="btn-primary glow btn-block" style="margin-top: 10px;">
                        Masuk <i class="fas fa-sign-in-alt"></i>
                    </button>
                    <div class="divider"><span>ATAU</span></div>
                    <button onclick="handleGoogleLogin()" class="btn-google">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G">
                        Masuk dengan Google
                    </button>
                    <p id="authErrorMsg"></p>
                    <p class="auth-switch">Belum punya akun? <a onclick="switchAuthMode('register')">Daftar Sekarang</a></p>
                </div>
            </div>

            <div id="registerView" style="display: none;">
                <div class="login-header">
                    <div class="icon-pulse">üöÄ</div>
                    <h1>Buat Akun</h1>
                    <p>Bergabunglah bersama kami</p>
                </div>
                <div class="login-form">
                    <div class="input-group" style="margin-bottom: 10px;">
                        <i class="fas fa-user"></i>
                        <input type="text" id="regUsername" placeholder="Nama Panggilan Kamu" aria-label="Nama Panggilan">
                    </div>
                    <div class="input-group" style="margin-bottom: 10px;">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="regEmail" placeholder="Email Aktif" aria-label="Email Pendaftaran">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="regPass" placeholder="Password (Min. 6 Karakter)" aria-label="Kata Sandi Pendaftaran">
                    </div>
                    <button onclick="handleRegister()" class="btn-primary glow btn-block" style="margin-top: 20px;">Daftar Akun</button>
                    <p class="auth-switch">Sudah punya akun? <a onclick="switchAuthMode('login')">Login di sini</a></p>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container" id="mainContent" style="display: none;">
        
        <header class="header-modern fade-in">
            <div class="header-profile-section">
                <div class="avatar-container" onclick="toggleSettings()">
                    <div class="avatar-hexagon">
                        <i class="fas fa-user-astronaut"></i>
                    </div>
                    <div class="level-badge-floating">Lvl <span id="userLevel">1</span></div>
                </div>
                <div class="text-info">
                    <p id="headerDate" class="mini-date"></p>
                    <h1 id="greeting">Halo, User! üëã</h1>
                    <div class="status-pill"><span class="dot-online"></span> <span id="loginStatusText">Online</span></div>
                </div>
            </div>
        
            <div class="header-stats-section">
                <div class="xp-box">
                    <div class="xp-info">
                    <span id="userRank" class="xp-label" style="color:var(--primary); font-weight:800; text-transform:uppercase; letter-spacing:0.5px;">Murid Baru üå±</span>
    <span id="xpText" class="xp-val" style="font-size:0.75rem;">0 / 100 XP</span>
                    </div>
                    <div class="xp-track">
                        <div class="xp-fill" id="xpBarFill" style="width: 0%;">
                            <div class="xp-glow"></div>
                        </div>
                    </div>
                </div>
                
                <div class="streak-box" title="Login Berturut-turut">
                    <i class="fas fa-fire flame-anim"></i>
                    <div class="streak-info">
                        <span id="streakCount" class="streak-num">0</span>
                        <span class="streak-label">Streak</span>
                    </div>
                </div>
            </div>
        
            <div class="header-action-section">
                <div class="digital-clock">
                    <span id="clockTime">00:00</span>
                </div>
                
                <div class="action-buttons">
                    <button class="icon-btn-glass" onclick="toggleDarkMode()" title="Ganti Tema">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <div class="profile-menu">
                        <span id="backupReminder" class="backup-badge"></span> 
                        <button class="icon-btn-glass" onclick="toggleSettings()" aria-label="Pengaturan">
                            <i class="fas fa-cog"></i>
                        </button>
                        
                        <div class="dropdown-menu" id="settingsDropdown">
                            <div class="dropdown-header">
                                <span id="displayUsername">User</span>
                            </div>
                            <div class="dropdown-divider"></div>
                            <button onclick="editUsername()"><i class="fas fa-user-edit"></i> Ganti Nama</button>
                            <button onclick="openAchievementModal()"><i class="fas fa-trophy"></i> Pencapaian</button>
                            
                            <button onclick="toggleExamMode()"><i class="fas fa-graduation-cap"></i> Mode Ujian</button>
                            <button onclick="showSoundSettings()"><i class="fas fa-volume-up"></i> Suara</button>
                            <div class="dropdown-divider"></div>
                            <button onclick="exportData()"><i class="fas fa-download"></i> Backup</button>
                            <button onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Restore</button>
                            <input type="file" id="importFile" hidden onchange="importData(this)" aria-label="Upload File Backup">
                            <div class="dropdown-divider"></div>
                            <button onclick="logoutUser()"><i class="fas fa-sign-out-alt"></i> Keluar</button>
                            <button onclick="openClearDataModal()" class="text-danger"><i class="fas fa-trash-alt"></i> Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="quote-modern fade-in-up">
            <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
            <div class="quote-text-wrapper">
                <p id="motivationQuote" class="quote-text">"Memuat motivasi..."</p>
            </div>
            <div class="quote-deco">‚ú®</div>
        </div>

        <div class="dashboard-grid fade-in-up">
            
            <div class="left-column">
                
                <div class="card schedule-section">
                    <div class="card-header">
                        <div class="title-with-icon">
                            <div class="icon-box purple"><i class="fas fa-book-open"></i></div>
                            <h2>Jadwal Belajar</h2>
                        </div>
                        <div class="controls">
                            <select id="weekTypeSelector" onchange="changeWeekType()" aria-label="Pilih Tipe Minggu">
                                <option value="auto">Auto (Minggu Bergantian)</option>
                                <option value="umum">Minggu Umum (Paksa)</option>
                                <option value="produktif">Minggu Produktif (Paksa)</option>
                            </select>
                            <div class="nav-pills">
                                <button onclick="changeDay(-1)" aria-label="Hari Sebelumnya"><i class="fas fa-chevron-left"></i></button>
                                <span id="activeDayName">SENIN</span>
                                <button onclick="changeDay(1)" aria-label="Hari Selanjutnya"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>

                    <div class="filter-controls-advanced">
                        <select id="scheduleFilterCategory" onchange="renderSchedule()" aria-label="Filter Kategori Jadwal">
                            <option value="all">Filter Kategori (Semua)</option>
                            <option value="umum">Umum</option>
                            <option value="produktif">Produktif</option>
                            <option value="kokurikuler">Kokurikuler</option>
                        </select>
                        <select id="scheduleFilterGuru" onchange="renderSchedule()" aria-label="Filter Guru Jadwal">
                            <option value="all">Filter Guru/Dosen (Semua)</option>
                        </select>
                    </div>
                    <div class="schedule-status-bar">
                        <span class="status-dot"></span>
                        <span id="currentStatus">Memuat status...</span>
                    </div>

                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th width="35%">Mata Pelajaran</th>
                                    <th width="25%">Waktu</th>
                                    <th width="30%">Catatan</th>
                                    <th width="10%">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody"></tbody>
                        </table>
                        <div id="holidayMessage" class="empty-state" style="display: none;">
                            <div class="empty-icon">‚òï</div>
                            <h3>Hari Libur!</h3>
                            <p>Waktunya istirahat atau kembangkan skillmu.</p>
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <button onclick="openAddScheduleModal()" class="btn-primary" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <i class="fas fa-plus-circle"></i> Tambah Jadwal Baru
                        </button>
                    </div>

                </div>

                <div class="card urgent-card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="title-with-icon">
                            <div class="icon-box red"><i class="fas fa-exclamation-triangle"></i></div>
                            <h2>Deadline Mendesak (< 3 Hari)</h2>
                        </div>
                    </div>
                    <ul id="urgentList" class="urgent-list"></ul>
                </div>
                
                <div class="card pomodoro-card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="title-with-icon">
                            <div class="icon-box red"><i class="fas fa-clock"></i></div>
                            <h2>Fokus Mode (Pomodoro)</h2>
                        </div>
                        <span class="mode-label" id="timerMode">FOKUS</span>
                    </div>

                    <div class="focus-mode-selector" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 15px;">
                        <button id="btnModeStrict" onclick="setFocusType('strict')" class="mode-btn active" title="Timer mati jika pindah tab">
                            üîí Ketat
                        </button>
                        <button id="btnModeChill" onclick="setFocusType('chill')" class="mode-btn" title="Bebas buka tab lain">
                            ‚òï Santai
                        </button>
                    </div>

                    <div id="focusModeLockText" style="display:none; text-align:center; margin-bottom: 10px; font-weight: 600; color: #ffeb3b; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 8px;">
                        ‚ö†Ô∏è MODE KETAT: Jangan ganti tab!
                    </div>

                    <div class="timer-display">
                        <h1 id="timerDisplay">25:00</h1>
                        <p id="timerMessage">Waktunya Bekerja Keras</p>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 20px;">
                         <select id="pomodoroTaskSelector" class="sub-input" aria-label="Pilih Tugas untuk Fokus">
                            <option value="">-- Pilih Tugas untuk Fokus --</option>
                         </select>
                    </div>

                    <div class="timer-controls">
                        <button class="btn-primary" id="startPauseBtn" onclick="startTimer()">Mulai</button>
                        <button class="btn-text-danger" onclick="resetTimer()"><i class="fas fa-redo"></i> Reset</button>
                    </div>
                </div>

                <div class="card focus-stats-card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="title-with-icon">
                            <div class="icon-box purple"><i class="fas fa-chart-bar"></i></div>
                            <h2>Analisis Fokus (7 Hari Terakhir)</h2>
                        </div>
                    </div>
                    <div class="chart-section">
                        <div id="focusChartContainer" class="expense-chart-container">
                            <p class="empty-message small">Belum ada data fokus.</p>
                        </div>
                    </div>
                </div>

            </div>

            <div class="sidebar-column">
                
                <div class="card music-card">
                    <div class="card-header" style="margin-bottom:10px;">
                         <div class="title-with-icon">
                            <div class="icon-box blue"><i class="fas fa-music"></i></div>
                            <h2>LoFi Radio</h2>
                        </div>
                    </div>
                    <div class="music-player-wrapper">
                        <iframe style="border-radius:12px" src="https://www.youtube.com/embed/jfKfPfyJRdk?si=LoFiGirl&controls=0&start=0" title="LoFi Player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen width="100%" height="200"></iframe>
                        <p style="font-size:0.8rem; text-align:center; margin-top:5px; color:var(--text-sub);">Dengerin biar rileks üéß</p>
                    </div>
                </div>

                <div class="card todo-card">
                    <div class="card-header">
                        <div class="title-with-icon">
                            <div class="icon-box blue"><i class="fas fa-check-circle"></i></div>
                            <h2>Tugas</h2>
                        </div>
                        <div class="progress-circle" id="taskProgressCircle">
                            <span id="taskProgressText">0%</span>
                            <svg viewBox="0 0 36 36">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                <path class="circle" id="taskProgressPath" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            </svg>
                        </div>
                    </div>

                    <div class="filter-tabs">
                        <button class="tab active" onclick="filterTasks('all', this)">Semua</button>
                        <button class="tab" onclick="filterTasks('pending', this)">Belum</button>
                        <button class="tab" onclick="filterTasks('completed', this)">Selesai</button>
                        <button class="tab btn-clear" onclick="clearCompletedTasks()" title="Hapus semua yang selesai">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>

                    <div class="search-input">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchTaskInput" placeholder="Cari tugas..." onkeyup="loadTasks()" aria-label="Cari Tugas">
                    </div>

                    <div class="add-task-form">
                        <input type="text" id="taskInput" class="main-input" placeholder="Tugas baru..." aria-label="Nama Tugas Baru">
                        <div class="form-row">
                            <input type="date" id="taskDate" class="sub-input" aria-label="Tanggal Tugas">
                            <select id="taskPriority" class="sub-input" aria-label="Prioritas Tugas">
                                <option value="Low">Prioritas Rendah (santai)</option>
                                <option value="Medium" selected>Prioritas Sedang (cukup penting)</option>
                                <option value="High">Prioritas Tinggi (sangat penting)</option>
                            </select>
                        </div>
                        <button id="addTaskBtn" class="btn-block btn-primary" onclick="handleTaskButton()">Tambah Tugas</button>
                    </div>
                    
                    <small style="display:block; text-align:center; color:var(--text-sub); font-size:0.7rem; margin-bottom:5px;">üí° Tips: Tahan & geser untuk atur urutan tugas.</small>
                    <ul id="taskList" class="task-list"></ul>
                </div>

                <div class="card finance-card" id="financeCard">
                    <div class="card-header">
                        <div class="title-with-icon">
                            <div class="icon-box green"><i class="fas fa-wallet"></i></div>
                            <h2>Keuangan</h2>
                        </div>
                        <div class="balance-display">
                            <small>Total Aset</small>
                            <h3 id="totalBalance">Rp 0</h3>
                        </div>
                    </div>

                    <div class="target-widget" onclick="editTarget()">
                        <div class="target-header">
                            <span id="targetName">üéØ Set Target</span>
                            <span id="targetAmount">Rp 0</span>
                        </div>
                        <div class="progress-bar-bg"><div id="targetProgressBar" class="progress-bar-fill"></div></div>
                        <small id="targetPercentage">0% tercapai</small>
                    </div>

                    <div class="chart-section">
                        <h4>Distribusi Pengeluaran</h4>
                        <div id="expenseChartContainer" class="expense-chart-container"></div>
                    </div>
                    
                    <div class="wallet-label">Pilih Sumber Dana:</div>
                    <div class="wallet-grid">
                        <div class="wallet-card dana" onclick="selectWallet('dana', this)">
                            <div class="card-top">
                                <span>DANA</span>
                                <i class="fas fa-check-circle check-icon"></i>
                            </div>
                            <div class="card-bottom">
                                <b id="saldo-dana">Rp 0</b>
                            </div>
                            <i class="bg-icon fas fa-wallet"></i>
                        </div>

                        <div class="wallet-card ovo" onclick="selectWallet('ovo', this)">
                            <div class="card-top">
                                <span>OVO</span>
                                <i class="fas fa-check-circle check-icon"></i>
                            </div>
                            <div class="card-bottom">
                                <b id="saldo-ovo">Rp 0</b>
                            </div>
                            <i class="bg-icon fas fa-mobile-alt"></i>
                        </div>

                        <div class="wallet-card gopay" onclick="selectWallet('gopay', this)">
                            <div class="card-top">
                                <span>GOPAY</span>
                                <i class="fas fa-check-circle check-icon"></i>
                            </div>
                            <div class="card-bottom">
                                <b id="saldo-gopay">Rp 0</b>
                            </div>
                            <i class="bg-icon fas fa-motorcycle"></i>
                        </div>

                        <div class="wallet-card cash active" onclick="selectWallet('cash', this)">
                            <div class="card-top">
                                <span>TUNAI</span>
                                <i class="fas fa-check-circle check-icon"></i>
                            </div>
                            <div class="card-bottom">
                                <b id="saldo-cash">Rp 0</b>
                            </div>
                            <i class="bg-icon fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    <input type="hidden" id="selectedWallet" value="cash">

                    <div class="transaction-box">
                       
                        <input type="text" id="moneyDesc" placeholder="Keterangan (Cth: Jajan)" aria-label="Keterangan Transaksi">
                        <div class="form-row">
                            <input type="number" id="moneyAmount" placeholder="Rp..." aria-label="Jumlah Uang">
                            <select id="txnCategory" aria-label="Kategori Transaksi">
                                <option value="Jajan">üçî Jajan</option>
                                <option value="Transport">üöó Transport</option>
                                <option value="Tabungan">üí∞ Tabungan</option>
                                <option value="Belanja">üõçÔ∏è Belanja</option>
                                <option value="Lainnya">‚ú® Lainnya</option>
                            </select>
                        </div>
                       <div class="btn-group">
                            <button class="btn-in" onclick="addTransaction('in')"><i class="fas fa-arrow-down"></i> Masuk</button>
                            <button class="btn-out" onclick="addTransaction('out')"><i class="fas fa-arrow-up"></i> Keluar</button>
                        </div>

                        <button class="action-btn transfer-btn" onclick="toggleTransferModal()" style="width:100%; margin-top:10px; background:var(--orange); color:white; padding:10px; border-radius:10px;">
                            <i class="fas fa-exchange-alt"></i> Transfer Antar Dompet
                        </button>
                         <button class="action-btn sub-btn" onclick="openSubModal()" style="width:100%; margin-top:10px; background:var(--purple); color:white; padding:10px; border-radius:10px;">
                            <i class="fas fa-calendar-check"></i> Kelola Langganan Rutin
                        </button>
                    </div>

                    <div class="history-section">
                        <div class="history-header">
                            <h4>Riwayat</h4>
                            <select id="historyFilter" onchange="loadTransactions()" aria-label="Filter Riwayat Transaksi">
                                <option value="all">Semua</option>
                                <option value="in">Masuk</option>
                                <option value="out">Keluar</option>
                            </select>
                            <button class="btn-mini" onclick="exportFinanceReport()" title="Download"><i class="fas fa-download"></i></button>
                        </div>
                        <ul id="transactionList" class="history-list"></ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="toastBox"></div>
    <div id="soundModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up" style="max-width: 350px;">
            <div class="modal-head">
                <h3>üîä Suara Notifikasi</h3>
                <button class="close-icon" onclick="document.getElementById('soundModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="pomodoroSoundSelect">Pilih Suara Pomodoro Selesai</label>
                    <select id="pomodoroSoundSelect">
                        <option value="bell">Bel Sekolah (Default)</option>
                        <option value="ding">Ding Jernih</option>
                        <option value="classic">Nada Klasik Retro</option>
                        <option value="silent">Hening</option>
                    </select>
                </div>
            </div>
            <div class="modal-foot">
                 <button onclick="saveSoundSettings()" class="btn-primary">Simpan</button>
            </div>
        </div>
    </div>
    <div id="usernameModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up" style="max-width: 350px;">
            <div class="modal-head">
                <h3>üë§ Ganti Nama</h3>
                <button class="close-icon" onclick="document.getElementById('usernameModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="newUsernameInput">Nama Baru</label>
                    <input type="text" id="newUsernameInput" placeholder="Nama panggilan...">
                </div>
            </div>
            <div class="modal-foot">
                 <button onclick="saveUsername()" class="btn-primary">Simpan</button>
            </div>
        </div>
    </div>
    
    <div id="achievementModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up" style="max-width: 450px;">
            <div class="modal-head">
                <div style="display:flex; align-items:center; gap:10px;">
                    <h3 style="margin:0;">üèÜ Pencapaian Saya</h3>
                    <span id="achievelmentCountBadge" style="background:var(--primary); color:white; padding:2px 8px; border-radius:10px; font-size:0.75rem; font-weight:700;">0/6</span>
                </div>
                <button class="close-icon" onclick="document.getElementById('achievementModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <p style="font-size:0.85rem; color:var(--text-sub); margin-bottom:15px;">Selesaikan misi untuk membuka piala!</p>
                <div id="achievementList" class="achievement-grid">
                    </div>
            </div>
        </div>
    </div>

    <div id="clearDataModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up" style="max-width: 400px;">
            <div class="modal-head">
                <h3 class="text-danger">‚ö†Ô∏è Hapus Semua Data</h3>
                <button class="close-icon" onclick="document.getElementById('clearDataModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color:var(--red); margin-bottom: 15px;">Tindakan ini permanen. Semua Tugas, Jadwal, Keuangan, dan Pengaturan Anda akan hilang dari browser ini.</p>
                <div class="form-group">
                    <label for="clearDataConfirmationInput">Ketik kata **HAPUS** untuk melanjutkan:</label>
                    <input type="text" id="clearDataConfirmationInput" placeholder="Ketik HAPUS">
                </div>
            </div>
            <div class="modal-foot">
                <button onclick="confirmClearUserData()" class="btn-primary" style="background:var(--red);">Konfirmasi Hapus</button>
            </div>
        </div>
    </div>
    
    <div id="noteModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up">
            <div class="modal-head">
                <h3 id="noteModalTitle">üìù Catatan Mapel</h3>
                <button class="close-icon" onclick="closeNoteModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p id="noteModalSubtitle" style="font-size:0.85rem; color:var(--text-sub); margin-bottom:10px;">Tulis PR atau catatan penting di sini.</p>
                <textarea id="noteModalInput" placeholder="Contoh: PR Halaman 52 dikumpulkan besok..." aria-label="Isi Catatan Mapel"></textarea>
                <input type="hidden" id="noteTargetDay">
                <input type="hidden" id="noteTargetIndex">
            </div>
            <div class="modal-foot">
                <button onclick="deleteNote()" class="btn-text-danger">Hapus</button>
                <button onclick="saveNoteFromModal()" class="btn-primary">Simpan Catatan</button>
            </div>
        </div>
    </div>

  <div id="scheduleEditModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up">
            <div class="modal-head">
                <h3>‚úèÔ∏è Edit Jadwal</h3>
                <button class="close-icon" onclick="closeScheduleEditModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editMapelName">Mata Pelajaran</label>
                    <input type="text" id="editMapelName">
                </div>
                <div class="form-group">
                    <label for="editMapelTime">Waktu</label>
                    <input type="text" id="editMapelTime" placeholder="08.00 - 09.20">
                </div>
                <div class="form-group">
                    <label for="editMapelType">Kategori</label>
                    <select id="editMapelType">
                        <option value="umum">Umum (Hijau)</option>
                        <option value="produktif">Produktif (Oranye)</option>
                        <option value="kokurikuler">Kokurikuler (Biru)</option>
                    </select>
                </div>
            </div>
            <div class="modal-foot" style="justify-content: space-between;">
                <button onclick="deleteSchedule()" class="btn-text-danger"><i class="fas fa-trash"></i> Hapus</button>
                <button onclick="saveScheduleChanges()" class="btn-primary">Simpan Perubahan</button>
            </div>
        </div>
    </div>
    <div id="addScheduleModal" class="modal-backdrop" style="display: none;">
        <div class="modal-content fade-in-up">
            <div class="modal-head">
                <h3>‚ûï Tambah Jadwal</h3>
                <button class="close-icon" onclick="document.getElementById('addScheduleModal').style.display='none'">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="addScheduleWeekType">Pilih Minggu</label>
                    <select id="addScheduleWeekType">
                        <option value="umum">Minggu Umum</option>
                        <option value="produktif">Minggu Produktif</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="addScheduleDay">Pilih Hari</label>
                    <select id="addScheduleDay">
                        <option value="Senin">Senin</option>
                        <option value="Selasa">Selasa</option>
                        <option value="Rabu">Rabu</option>
                        <option value="Kamis">Kamis</option>
                        <option value="Jumat">Jumat</option>
                        <option value="Sabtu">Sabtu</option>
                        <option value="Minggu">Minggu</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="addScheduleMapel">Mata Pelajaran</label>
                    <input type="text" id="addScheduleMapel" placeholder="Contoh: Matematika">
                </div>
                <div class="form-group">
                    <label for="addScheduleGuru">Nama Guru</label>
                    <input type="text" id="addScheduleGuru" placeholder="Contoh: Bpk. Budi">
                </div>
                <div class="form-group">
                    <label for="addScheduleTime">Waktu</label>
                    <input type="text" id="addScheduleTime" placeholder="Contoh: 08.00 - 09.20">
                </div>
                <div class="form-group">
                    <label for="addScheduleType">Kategori (Warna)</label>
                    <select id="addScheduleType">
                        <option value="umum">Umum (Hijau)</option>
                        <option value="produktif">Produktif (Oranye)</option>
                        <option value="kokurikuler">Kokurikuler (Biru)</option>
                    </select>
                </div>
            </div>
            <div class="modal-foot">
                <button onclick="saveNewSchedule()" class="btn-primary btn-block">Tambah Jadwal</button>
            </div>
        </div>
    </div>
   
   <div id="transferModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
        <div class="modal-header">
            <h3>Transfer Saldo</h3>
            <button onclick="toggleTransferModal()" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="sourceWallet">Dari Dompet</label>
                <select id="sourceWallet">
                    <option value="dana">DANA</option>
                    <option value="ovo">OVO</option>
                    <option value="gopay">GOPAY</option>
                    <option value="cash">TUNAI</option>
                </select>
            </div>
            
            <div class="transfer-arrow" style="text-align:center; font-size:1.5rem; margin:10px 0;">‚¨áÔ∏è</div>

            <div class="form-group">
                <label for="targetWallet">Ke Dompet</label>
                <select id="targetWallet">
                    <option value="cash">TUNAI</option>
                    <option value="dana">DANA</option>
                    <option value="ovo">OVO</option>
                    <option value="gopay">GOPAY</option>
                </select>
            </div>

            <div class="form-group">
                <label for="transferAmount">Jumlah (Rp)</label>
                <input type="number" id="transferAmount" placeholder="0">
            </div>

            <button onclick="executeTransfer()" class="save-btn btn-primary btn-block">Konfirmasi Transfer</button>
        </div>
    </div>
</div>

<div id="subModal" class="modal-backdrop" style="display: none;">
    <div class="modal-content fade-in-up">
        <div class="modal-head">
            <h3>üìÖ Langganan & Tagihan</h3>
            <button class="close-icon" onclick="document.getElementById('subModal').style.display='none'">√ó</button>
        </div>
        <div class="modal-body">
            <div class="total-fixed-cost">
                <small>Estimasi Pengeluaran Tetap Bulanan:</small>
                <h2 id="totalSubCost">Rp 0</h2>
            </div>

            <div style="background: var(--bg-body); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <label style="font-size:0.8rem; font-weight:700;">Tambah Langganan Baru</label>
                <div class="form-group" style="margin-top:10px;">
                    <input type="text" id="subName" placeholder="Nama (Cth: Netflix, Kosan)" aria-label="Nama Langganan">
                </div>
                <div class="form-row">
                    <input type="number" id="subCost" placeholder="Harga (Rp)" aria-label="Harga Langganan">
                    <input type="number" id="subDate" placeholder="Tgl Tagihan (1-31)" min="1" max="31" aria-label="Tanggal Tagihan">
                </div>
                <button onclick="addSubscription()" class="btn-primary btn-block">Simpan</button>
            </div>

            <label style="font-size:0.8rem; font-weight:700; color:var(--text-sub);">Daftar Aktif:</label>
            <div id="subList" class="achievement-grid" style="max-height: 250px; margin-top: 10px;">
                </div>
        </div>
    </div>
</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBNfmxs3iOYOlWdscHj6SX0DP5xxmTCfyU",
            authDomain: "full-code-e7288.firebaseapp.com",
            databaseURL: "https://full-code-e7288-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "full-code-e7288",
            storageBucket: "full-code-e7288.firebasestorage.app",
            messagingSenderId: "915799491478",
            appId: "1:915799491478:web:7401bc680ffc4a888653b7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        window.db = db; 
        window.dbRef = ref; 
        window.dbSet = set; 
        window.dbOnValue = onValue; 
        window.dbRemove = remove;
        
        window.auth = auth;
        window.googleProvider = googleProvider;
        window.authSignIn = signInWithEmailAndPassword;
        window.authSignUp = createUserWithEmailAndPassword;
        window.authSignOut = signOut;
        window.authListener = onAuthStateChanged;
        window.authUpdateProfile = updateProfile;
        window.authSignInGoogle = signInWithPopup;

        console.log("Sistem Login & Database Siap!");
    </script>
   
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>